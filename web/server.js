const os = require('os');
const express = require('express');
const app = express();
const redis = require('redis');
const redisClient = redis.createClient({
  host: 'redis',
  port: 6379
});

app.get('/', function(req, res) {
    redisClient.get('numVisits', function(err, numVisits) {
        numVisitsToDisplay = parseInt(numVisits) + 1;
        if (isNaN(numVisitsToDisplay)) {
            numVisitsToDisplay = 1;
        }
       res.send(os.hostname() +': Number of visits is: ' + numVisitsToDisplay);
        numVisits++;
        redisClient.set('numVisits', numVisits);
    });
});

app.get('/teste', function(req, res) {
    redisClient.get('numVisits', function(err) {
        res.json({"teste":"teste cache"});
    });
});

app.get('/v1/menu/menu-web-logged-out-config', function(req, res) {
    redisClient.get('numVisits', function(err) {
        res.json({"menu_id":"menu-web-logged-out-config","name":"Web Deslogada","type":"menu-web-logged-out","items":[{"products":["all"],"_id":"6391e8e4e2ea8500120db68b","title":"Início","order":1,"advisory_rating":"L","link_to":"/","sub_items":[]},{"products":["all"],"_id":"6391e8e4e2ea8500120db68c","title":"Assistir","order":2,"advisory_rating":"L","link_to":"submenu","sub_items":[{"products":["all"],"_id":"6391e8e4e2ea8500120db68d","title":"Ação e aventura","order":1,"advisory_rating":"L","link_to":"/acao-e-aventura"},{"products":["all"],"_id":"6391e8e4e2ea8500120db68e","title":"Comédia","order":2,"advisory_rating":"L","link_to":"/comedia"},{"products":["all"],"_id":"6391e8e4e2ea8500120db68f","title":"Crianças","order":3,"advisory_rating":"L","link_to":"/criancas"},{"products":["all"],"_id":"6391e8e4e2ea8500120db690","title":"Drama","order":4,"advisory_rating":"L","link_to":"/drama"},{"products":["all"],"_id":"6391e8e4e2ea8500120db691","title":"Família e Infantil","order":5,"advisory_rating":"L","link_to":"/familia-e-infantil"},{"products":["all"],"_id":"6391e8e4e2ea8500120db692","title":"Ficção Científica","order":6,"advisory_rating":"L","link_to":"/ficcao-cientifica"},{"products":["all"],"_id":"6391e8e4e2ea8500120db693","title":"Romance","order":7,"advisory_rating":"L","link_to":"/romance"},{"products":["all"],"_id":"6391e8e4e2ea8500120db694","title":"Saúde e Bem-estar","order":8,"advisory_rating":"L","link_to":"/saude-e-bem-estar"},{"products":["all"],"_id":"6391e8e4e2ea8500120db695","title":"Suspense e terror","order":9,"advisory_rating":"L","link_to":"/suspense-e-terror"},{"products":["all"],"_id":"6391e8e4e2ea8500120db696","title":"Shows","order":10,"advisory_rating":"L","link_to":"/shows"},{"products":["all"],"_id":"6391e8e4e2ea8500120db697","title":"Séries","order":11,"advisory_rating":"L","link_to":"/series"}]},{"products":["all"],"_id":"6391e8e4e2ea8500120db698","sub_items":[],"title":"Ao Vivo","order":3,"advisory_rating":"L","link_to":"/ao-vivo"},{"products":["all"],"_id":"6391e8e4e2ea8500120db699","title":"Alugar","order":4,"advisory_rating":"L","link_to":"/alugue","sub_items":[]},{"products":["all"],"_id":"63b861356cdb780019742a6b","title":"Assine","order":5,"advisory_rating":"L","link_to":"/assine","sub_items":[]},{"products":["all"],"_id":"63b861356cdb780019742a6c","title":"Blog","order":6,"advisory_rating":"L","link_to":"/blog","sub_items":[]},{"products":["all"],"_id":"63b861356cdb780019742a6d","title":"Como Acessar","order":7,"advisory_rating":"L","link_to":"/como-acessar","sub_items":[]}]});
    });
});

app.get('/v1/screen/home-web-screen-config', function(req, res) {
    redisClient.get('numVisits', function(err) {
        res.json({"screen_id":"home-web-screen-config","title":"Home para web","type":"home-web","component_list":[{"products":["all"],"view_all":{"enable":false,"link_to":null},"component_id":"home-para-web-banners-banner-carousel","name":"Banners","title":"","type":"banner-carousel","info_type":"content","list_type":"playlist","order":1,"data_url":"https://api.mais.uol.com.br/apiuol/v5/collection/playlist?collection_id=27228&thumb_types=all"},{"products":["all"],"view_all":{"enable":false,"link_to":null},"component_id":"home-para-web-canais-landscape-carousel","name":"Ao vivo","title":"Ao vivo","type":"live-carousel","info_type":"content","list_type":"content-collections","order":2,"data_url":"https://api.mais.uol.com.br/apiuol/v5/collections?domain_ids=17&types=stream&items=20&thumb_types=all"},{"products":["all"],"view_all":{"enable":true,"link_to":"/series"},"component_id":"home-para-web-series-portrait-carousel","name":"Séries","title":"Séries","type":"portrait-carousel","info_type":"content","list_type":"content-collections","order":3,"data_url":"https://api.mais.uol.com.br/apiuol/v5/collections?domain_ids=17&sort=created_at&order=desc&types=series&thumb_types=all"},{"products":["all"],"view_all":{"enable":true,"link_to":"/filmes-seu-pacote"},"component_id":"home-para-web-filmes-do-seu-pacote-portrait-carousel","name":"Filmes","title":"Filmes","type":"portrait-carousel","info_type":"content","list_type":"content-collections","order":4,"data_url":"https://api.mais.uol.com.br/apiuol/v5/collections?domain_ids=17&sort=created_at&order=desc&types=movie&thumb_types=all"},{"products":["all"],"name":"Canais","title":"Canais","type":"channel-landscape-carousel","info_type":"content","list_type":"channel-list","order":5,"data_url":"https://api.mais.uol.com.br/apiuol/v5/channels?domain_id=17&channel_ids=209,208,207,103&thumb_types=107","view_all":{"enable":false,"link_to":null}},{"products":["all"],"view_all":{"enable":true,"link_to":"/history"},"name":"History","title":"History","type":"portrait-carousel","info_type":"content","list_type":"content-collections","order":6,"data_url":"https://api.mais.uol.com.br/apiuol/v5/collections?domain_ids=17&channel_id=84&sort=created_at&order=desc&types=movie,series&thumb_types=all&rent=no_rent&items=20"},{"products":["all"],"view_all":{"enable":false,"link_to":null},"component_id":"home-para-web-em-alta-portrait-carousel","name":"Em alta","title":"Em alta","type":"portrait-carousel","info_type":"content","list_type":"content-collections","order":7,"data_url":"https://api.mais.uol.com.br/apiuol/v5/collections?domain_ids=17&sort=views&order=desc&types=movie,series&thumb_types=all"},{"products":["all"],"view_all":{"enable":true,"link_to":"/alugue"},"component_id":"home-para-web-filmes-para-alugar-portrait-carousel","name":"Filmes para alugar","title":"Filmes para alugar","type":"portrait-carousel","info_type":"content","list_type":"content-collections","order":8,"data_url":"https://api.mais.uol.com.br/apiuol/v5/collections?domain_ids=17&sort=created_at&rent=rentable&order=desc&types=movie&thumb_types=all"},{"products":["all"],"view_all":{"enable":true,"link_to":"/familia-e-infantil"},"component_id":"home-para-web-familia-e-infantil-portrait-carousel","name":"Família e Infantil","title":"Família e Infantil","type":"portrait-carousel","info_type":"content","list_type":"content-collections","order":9,"data_url":"https://api.mais.uol.com.br/apiuol/v5/collections?domain_ids=17&genres=175&sort=created_at&order=desc&types=movie,series&thumb_types=all"},{"products":["all"],"view_all":{"enable":true,"link_to":"/reality-show"},"component_id":"home-para-web-reality-show-portrait-carousel","name":"Reality Show","title":"Reality Show","type":"portrait-carousel","info_type":"content","list_type":"content-collections","order":10,"data_url":"https://api.mais.uol.com.br/apiuol/v5/collections?domain_ids=17&genres=172&sort=created_at&order=desc&types=movie,series&thumb_types=all"},{"products":["all"],"view_all":{"enable":true,"link_to":"/petra-belas-artes"},"component_id":"home-para-web-petra-belas-artes-a-la-carte-portrait-carousel","name":"Petra Belas Artes À LA CARTE","title":"Petra Belas Artes À LA CARTE","type":"portrait-carousel","info_type":"content","list_type":"content-collections","order":11,"data_url":"https://api.mais.uol.com.br/apiuol/v5/collections?domain_ids=17&channel_id=103&sort=created_at&order=desc&types=movie&thumb_types=all"},{"products":["all"],"view_all":{"enable":false,"link_to":null},"component_id":"home-para-web-adicionados-recentemente-portrait-carousel","name":"Adicionados recentemente","title":"Adicionados recentemente","type":"portrait-carousel","info_type":"content","list_type":"content-collections","order":12,"data_url":"https://api.mais.uol.com.br/apiuol/v5/collections?domain_ids=17&sort=created_at&order=desc&types=movie,series&thumb_types=all"},{"products":["all"],"view_all":{"enable":false,"link_to":null},"component_id":"home-para-web-continuar-assistindo-portrait-carousel","name":"Continuar assistindo","title":"Continuar assistindo","type":"bookmark-carousel","info_type":"customer","list_type":"customer-bookmark","order":13,"data_url":"https://api.mais.uol.com.br/apiuol/v5/customer/profile/bookmarks/last?customer_profile_id=#profile_id#"},{"products":["all"],"view_all":{"enable":false,"link_to":null},"component_id":"home-para-web-minha-lista-portrait-carousel","name":"Minha lista","title":"Minha lista","type":"portrait-carousel","info_type":"customer","list_type":"content-collections","order":14,"data_url":"https://api.mais.uol.com.br/apiuol/v5/customer/profile/favorites?customer_profile_id=#profile_id#"}]});
    });
});


app.listen(5000, function() {
    console.log('Web application is listening on port 5000');
});
